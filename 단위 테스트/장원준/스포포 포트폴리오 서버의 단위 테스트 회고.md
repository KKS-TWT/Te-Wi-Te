# 스포포의 포트폴리오 서버 구현 시 단위 테스트에 대한 회고

## 테스트를 위해 헥사고날 아키텍처를 도입하다.

- 헥사고날 아키텍처 (육각형 아키텍처)란 도메인 계층과 애플리케이션 서비스 계층을 나누는 아키텍처입니다.

- 도메인 계층에서는 비즈니스 로직에만 집중할 수 있습니다.

- 도메인의 외부 통신은 애플리케이션 서비스 계층에서 담당합니다.

- 스포포의 포트폴리오 서버를 예로 들면 다음과 같습니다.

  - 도메인 계층 -> 포트폴리오, 주식, 매매이력

  - 애플리케이션 계층 -> 컨트롤러, 서비스 등

<br>

## 테스트를 위해 헥사고날 아키텍처를 도입했다고..??

- 헥사고날 아키텍처를 도입하면 테스트 할 때 다음과 같은 이점이 있습니다.

  1. 도메인 계층은 외부와 격리되어 있기 때문에 순수 자바 클래스로만 이루어져 있습니다.
  2. 따라서 단위 테스트를 작성하기 간편하며, 빠르고 쉽게 테스트를 작성할 수 있습니다.
  3. 애플리케이션 서비스 계층에서 통신 시 인터페이스를 통해 통신하므로, 테스트를 위한 구현체를 만들어서 쉽게 Mocking할 수 있습니다.
  4. 따라서 mock 프레임워크나 스프링 프레임워크에 의존하지 않고 독립적으로 mock 객체를 만들 수 있습니다.

- 예를 들어 다음과 같은 구조를 가질 수 있습니다.

  ```
  └── PortfolioService (Interface)
    ├── PortfolioServiceImpl (운영용 구현체)
    ├── FakePortfolioServiceImple (테스트용 구현체)

  └── HoldingStockService (Interface)
    ├── HoldingStockServiceImpl (운영용 구현체)
    ├── FakeHoldingStockServiceImple (테스트용 구현체)
  ```

<br>

## 처음엔 괜찮았는데 점점 테스트가 버거워진다.

- 위와 같이 헥사고날 아키텍처를 사용하면 인터페이스를 바탕으로 `테스트용 구현체`를 만들 수 있습니다.

- 예를 들어 공개 API가 1개 추가된다고 가정해 봅시다. 그렇다면 다음과 같은 작업이 이루어져야 합니다.

  1. 컨트롤러 코드 추가
     - 컨트롤러 테스트 추가
  2. 서비스 인터페이스에 코드 추가
     - 운영용, 테스트용 구현체에 코드 추가
     - 서비스 테스트 추가
  3. 레포지토리에 코드 추가
     - 레포지토리 테스트 추가
  4. 도메인에 코드 추가
     - 도메인 테스트 코드 추가

<br>

## 이게 맞는지 의문이 생깁니다.

- 새로운 API 추가 시 컨트롤러, 서비스, 레포지토리에만 코드가 추가되면 되는데 테스트를 위해 작성해야 할 코드가 매번 2배 이상 늘어나 버립니다. (물론 테스트를 하는 것이 좋긴 하지만요!)

- 인터페이스를 무조건 작성해야 하기 때문에 가독성이 좋지 않습니다.

- 오직 테스트만을 위해 서비스 클래스를 인터페이스로 구현하도록 만들어야 하니 인터페이스의 본질적 의미와 약간 맞지 않는다는 생각도 듭니다.

<br>

## 느낀 점 및 아쉬웠던 점

- 토이 프로젝트와 달리 실제 제품을 만들 때는 시간, 인력 등의 자원을 고려해야 합니다.

- 따라서 추후에 프로젝트를 한다면, 프로젝트의 최종 목표와 제한된 자원을 생각하여 아키텍처를 구성해야 할 것 같습니다.

  - 만약 사용자가 많지 않고 어느 정도만 성정하고 끝일 것 같은 프로젝트라면 굳이 헥사고날 아키텍처를 도입하지 않고 개발 속도를 높일 것 같습니다.

  - 또, 정말 의미있는 테스트만 작성하여 테스트 작성 효율을 높여야 할 것 같습니다.

- 그러나 무엇보다 중요한 건 팀원과의 협의 후에 결정하는 내용이며 무조건 좋은 방법은 없다는 것입니다.
