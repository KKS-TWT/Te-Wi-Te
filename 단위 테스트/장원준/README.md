# 테스트의 목표

1. 테스트로 기능을 검증한다.
2. 배포 시 오류가 덜 할 것이라는 안정감을 준다.

<br>

# 자동화된 테스트를 어디까지 작성할 것인가?

1. 모든 기능에 대해 자동화된 테스트를 작성하면 좋다.

2. 그러나 현실적으로는 불가능하다.

   - 클라이언트의 요구사항은 끊임없이 바뀌기 때문에 모든 기능에 대해 정확한 테스트를 하기는 어렵다.

   - 마감 기한이 정해져 있기 때문에 테스트를 작성하는 데에만 시간을 쏟을 수 없다.

3. 그럼 어디까지 테스트를 작성할까?

   - 모든 코드에 대해 테스트를 작성하는 것보다, 검증하고자 하는 기능을 실제로 여러 번 실행하자.

   - 만약 배포 후 버그가 발생된다면, 버그 재현을 통해 코드를 수정 후 그 기능의 자동화 된 테스트를 작성하여 검증하자.

   - 가장 중요한 건 프로젝트 내의 규칙이므로, 반드시 프로젝트를 같이 진행하는 팀원과 상의하에 규칙을 따르는 것이 최우선이다.

<br>

# 단위 테스트란?

1. 작은 코드 조각을 검증한다.
2. 빠르게 수행한다.
3. 격리된 방식으로 처리하는 자동화 된 테스트다.

<br>

# 정적 분석 도구와 단위 테스트

## 정적 분석이란?

- 정적 분석은 비 런타임 시점에 취약점을 알아낼 수 있는 기법이다.

  - 원하는 Rule을 추가하여 팀 내의 코드 컨벤션을 강제하거나 취약점을 코드 실행 전에 발견할 수 있다.

- 사람이 직접해도 되지만, 보통 정적 분석 도구들을 많이 사용한다.

- intellij & java 환경에서는 다음과 같은 도구들이 있다.

  - PMD
  - Sonarqube
  - ...

- 관련 링크

  - [정적 분석이란?](https://hudi.blog/static-analysis/)

  - [정적 분석 사용하기](https://www.baeldung.com/java-static-code-analysis-tutorial)
  - [정적 분석 도구들](https://www.baeldung.com/java-static-analysis-tools)

<br>

## 정적 분석과 단위 테스트

- 우리는 모든 코드에 대해 단위 테스트를 작성하기는 어렵고, 또한 시간도 많이 든다.

- <u>따라서 정적 분석을 통해 미리 취약점을 예방할 수 있다면 단위 테스트를 작성하는 시간을 아끼면서도 안정성 있는 코드를 작성할 수 있을 것이다.</u>

- 아래 코드에서는 ArrayIndexOutOfBoundsException가 발생하는데, 정적 분석 도구에 rule을 추가하여 분석하면 index의 범위를 체크해야하는 로직을 넣어야 한다고 경고를 줄 수 있을 것이다.

- 그렇게 되면 ArrayIndexOutOfBoundsException에 대한 단위 테스트 코드를 작성하지 않고도 오류를 예방할 수 있게 된다.

- 그러나 정적 분석 도구로 `모든 오류를 예방할 수는 없다`는 것을 명심하자!

  ```java
  public class MyClass {

    public static void main(String[] args) {
      int[] arr = {1, 2, 3};
      print(arr, 5);
    }

    public static void print(int[] arr, int index) {
      // 정적 분석 도구를 활용하여 index 범위를 체크하는 로직을 넣어줄 수 있을 것이다.
      System.out.println(arr[index]);
    }
  }

  ```

<br>

# Test와 Repro

- 테스트를 잘 작성하기 위해서, 다른 개발자에게 버그가 일어났다는 것을 알리기 위해서는 repro를 잘해야 한다.

- Bug Reproduction란 버그를 다시 재현하는 시나리오를 의미한다.

  > 만약 메인 페이지 접속 후 로그인 버튼을 클릭했을 때 404 오류가 나타난다고 가정하자. <br><br>
  > 📌 **repro의 나쁜 예시**
  >
  > - 버그를 발견했을 당시의 상황을 추상적으로 이야기 하는 것
  >
  >   - "~~ 사이트의 로그인이 안돼요."
  >   - "~~ 사이트의 로그인 버튼 누르니까 404가 떠요." <br><br>

  > 📌 **repro의 좋은 예시**
  >
  > - 버그를 발견했을 당시의 상황을 최대한 자세히 이야기 하는 것
  >
  >   - "저는 윈도우 노트북을 사용하고 있습니다. 크롬 브라우저에서 주소창에 주소 입력 후 메인 페이지 접속까지는 잘 됩니다. 그런데 메인 페이지에서 로그인 버튼을 눌렀을 때 바로 404 페이지가 나타나는 오류가 있습니다. 상단바의 우측에도 로그인 버튼이 있는데 그 버튼을 눌렀을 경우에는 정상적으로 로그인이 잘 됩니다. 혹시 몰라 다른 브라우저인 엣지, 웨일, 오페라 등에서도 테스트 해보았는데 동일한 현상이 발생합니다. 분명 어제까지는 문제가 없었는데 오늘 아침에 로그인하려니 안되네요." <br><br>

- 위의 좋은 예시처럼 최대한 버그가 발생했을 시의 환경을 자세하게 이야기 할 수 있어야 다른 동료와 소통을 원활하게 할 수 있다.

- 또한 repro를 잘하면, 테스트 시 여러 가지 경우의 수를 계산하여 다양한 테스트를 할 수 있는 능력도 길러지게 된다.

- 관련 링크
  - [Bug Reproduction](https://www.testdevlab.com/blog/issue-reproduction-why-reproducing-bugs-matter)
